# Обновление системы привилегий VIP и PREMIUM

## Обзор изменений

Система привилегий была переработана для предоставления реальных преимуществ VIP и PREMIUM пользователям на основе существующих возможностей платформы.

## Новые привилегии

### VIP (VIP)
- ✅ **Попадает в свайп и каталог** - теперь VIP пользователи видны в системе поиска
- ✅ **3 объявления** - может разместить до 3 объявлений (вместо 1 для FREE)
- ✅ **Расширенная статистика** - может видеть детальную статистику профилей других пользователей
- ✅ **История посещений** - может видеть, кто посещал его профиль за последние 30 дней

### PREMIUM (PREMIUM)
- ✅ **Попадает в свайп и каталог** - теперь PREMIUM пользователи видны в системе поиска
- ✅ **7 объявлений** - может разместить до 7 объявлений (вместо 1 для FREE)
- ✅ **20% скидка на подарки** - все подарки стоят на 20% дешевле
- ✅ **Анонимные посещения** - может посещать профили VIP пользователей анонимно (без уведомлений)
- ✅ **Расширенная статистика** - может видеть детальную статистику профилей других пользователей
- ✅ **Расширенная история** - может видеть историю посещений за последние 90 дней
- ✅ **Топ посетителей** - может видеть топ-10 посетителей своего профиля

## Технические изменения

### 1. Система свайпов и каталога
- **Файл**: `src/routes/swipe.js`, `src/routes/catalog.js`
- **Изменение**: Обновлен фильтр для показа только VIP и PREMIUM пользователей
- **Код**: `viptype: { [Op.in]: ['VIP', 'PREMIUM'] }`

### 2. Система подарков со скидками
- **Файл**: `src/models/Gifts.js`, `src/routes/gifts.js`
- **Изменение**: Добавлена логика скидок для PREMIUM пользователей
- **Функция**: `Gifts.getGiftTypes(userVipType)` - возвращает подарки с учетом VIP статуса

### 3. Лимиты объявлений
- **Файл**: `src/routes/ads.js`
- **Изменение**: Обновлена логика проверки лимитов
- **Лимиты**:
  - FREE: 1 объявление
  - VIP: 3 объявления
  - PREMIUM: 7 объявлений

### 4. Анонимные посещения
- **Файл**: `src/routes/profiles.js`
- **Изменение**: PREMIUM пользователи могут посещать VIP профили анонимно
- **Логика**: `visitorUser.viptype === 'PREMIUM' && targetUser.viptype === 'VIP'`

### 5. Расширенная статистика профилей
- **Файл**: `src/routes/profiles.js`
- **Новый роут**: `GET /api/profiles/:login/stats`
- **Доступ**: Только для VIP и PREMIUM пользователей
- **Данные**:
  - Количество лайков фотографий
  - Количество комментариев к фотографиям
  - Количество комментариев к профилю
  - Количество реакций
  - Статистика посещений (30 дней для VIP, 90 дней для PREMIUM)
  - Топ-10 посетителей (только для PREMIUM)

## API изменения

### Новые эндпоинты
- `GET /api/profiles/:login/stats` - расширенная статистика профиля

### Обновленные эндпоинты
- `GET /api/gifts/types` - теперь возвращает подарки с учетом VIP статуса пользователя
- `POST /api/gifts/send` - учитывает скидки для PREMIUM пользователей
- `POST /api/profiles/:login/visit` - поддерживает анонимные посещения для PREMIUM
- `POST /api/ads/create` - проверяет лимиты в зависимости от VIP статуса

## Обратная совместимость

Все изменения обратно совместимы. Существующие пользователи сохраняют свои текущие привилегии, а новые функции активируются автоматически при наличии соответствующего VIP статуса.

## Тестирование

Рекомендуется протестировать:
1. Создание объявлений с разными VIP статусами
2. Отправку подарков с учетом скидок
3. Анонимные посещения PREMIUM пользователей
4. Доступ к расширенной статистике
5. Отображение пользователей в свайпе и каталоге
